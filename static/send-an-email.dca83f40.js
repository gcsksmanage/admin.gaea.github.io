import{d as R,r as u,U as H,R as C,n as O,H as E,V as F,E as h,o as b,c as k,f as r,w as i,b as f,u as t,W as N,q as S,X as T,Y as U,p as P,a as q,_ as z,e as I,v as j,g as A,h as D,i as M,k as J,l as W}from"./entry.15a76552.js";import{_ as K}from"./client-only.17f8f7d7.js";import{i as V}from"./index.a0298ae1.js";/* empty css                 *//* empty css                *//* empty css                  */import{M as L}from"./adminManage.c8246d07.js";import{t as X}from"./throttle.46d02480.js";import"./request.72540ff6.js";const Y=c=>(P("data-v-3512d773"),c=c(),q(),c),G={key:0,class:"bg-black fixed inset-0 z-[99999999] overflow-scroll w-full h-full flex justify-center items-center px-6 py-4"},Q=["src"],Z=Y(()=>f("span",{class:"w-full h-full flex justify-center items-center text-white"},[f("span",{class:"iconfont icon-error text-2xl font-bold"})],-1)),ee=[Z],te=R({__name:"wangEditor",props:{txtHtml:{default:""},defaulTxtHtml:{default:""},isReadOnly:{type:Boolean,default:!0},isShowBorder:{type:Boolean,default:!1}},emits:["update:html-data"],setup(c,{emit:d}){const s=c,_=u(null),e=u(null),y=H(),m=u();return C(()=>s.txtHtml,o=>{V(e.value)||e.value.txt.html(o)},{deep:!0}),C(()=>s.isReadOnly,o=>{V(e.value)||e.value.$textElem.attr("contenteditable",o)},{deep:!0}),O(async()=>{await E(),F(()=>import("./wangEditor.936afaa9.js").then(o=>o.w),["./wangEditor.936afaa9.js","./entry.15a76552.js","./entry.9aac1b1b.css"],import.meta.url).then(o=>{e.value=new o.default(_.value),e.value.customConfig=e.value.customConfig?e.value.customConfig:e.value.config,e.value.customConfig.menus=s.isReadOnly?["head","bold","fontSize","fontName","italic","underline","strikeThrough","foreColor","backColor","list","justify","quote","emoticon","table","undo","redo"]:[],e.value.config.uploadImgHeaders={Authorization:`Bearer ${y.getToken}`},e.value.customConfig.uploadFileName="file",e.value.customConfig.uploadImgServer="/api/file/upload",e.value.customConfig.uploadImgHooks={success:function(a,g,l){},fail:function(){h({message:"上传成功，插入失败",grouping:!0,type:"error"})},error:function(){h({message:"上传失败，请重试",grouping:!0,type:"error"})},timeout:function(){h({message:"上传超时！",grouping:!0,type:"error"})}},e.value.config.pasteIgnoreImg=!0,e.value.config.customUploadImg=async(a,g)=>{},e.value.create(JSON.parse(JSON.stringify(s.txtHtml))),e.value.$textElem.attr("contenteditable",s.isReadOnly),E(()=>{e.value.txt.html(s.txtHtml)}),e.value.config.onchange=a=>{d("update:html-data",a)},e.value.$textElem.on("click","img",function(a){a.stopPropagation(),m.value=a.target.getAttribute("src")})}).catch(o=>{})}),(o,a)=>{const g=K;return b(),k("div",{class:U(["w-[50%] h-[350px]",{is_read_only:!o.$props.isReadOnly,is_show_border:o.isShowBorder}])},[r(g,null,{default:i(()=>[f("div",{ref_key:"editorEl",ref:_,class:"editorEl_box h-full flex flex-col justify-between"},null,512)]),_:1}),r(T,{name:"fade"},{default:i(()=>[t(m)?(b(),k("div",G,[f("img",{src:t(m),alt:"",class:"max-h-full object-cover"},null,8,Q),f("div",{class:"w-10 h-10 bg-red bg-opacity-80 rounded-full fixed z-20 top-12 right-12 cursor-pointer",onClick:a[0]||(a[0]=N(l=>m.value="",["stop"]))},ee)])):S("",!0)]),_:1})],2)}}});const oe=z(te,[["__scopeId","data-v-3512d773"]]),le={class:"h-[80vh] text-[#ebebeb] p-12 overflow-auto"},ae={class:"w-[65%] flex justify-center"},fe=R({__name:"send-an-email",setup(c){const d=u(!1),s=u(0),_=u(""),e=I({email:"",subject:"",content:""}),y=u(),m=I({email:[{required:!0,message:"请输入",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],subject:[{required:!0,message:"请输入",trigger:"blur"}],content:[{required:!0,message:"请输入",trigger:"blur"}]}),o=l=>{e.content=l},a=l=>{l&&l.resetFields()},g=async l=>{l&&(d.value||await l.validate(async(n,w)=>{if(n)try{d.value=!0;const p={...e,subject:btoa(unescape(encodeURIComponent(e.subject))),content:btoa(unescape(encodeURIComponent(e.content)))},v=await L(p);v.code===200?h.success({message:v.data||"发送成功",grouping:!0,type:"success"}):h.error({message:v.msg,grouping:!0,type:"error"})}catch{}finally{d.value=!1,e.content="",_.value="",s.value+=1,a(l)}}))};return(l,n)=>{const w=D,p=M,v=oe,B=J,$=W;return b(),k("div",le,[r($,{ref_key:"ruleFormRef",ref:y,class:"w-full",inline:!0,"label-position":"right","label-width":"140px",model:t(e),rules:t(m)},{default:i(()=>[t(e).id?S("",!0):(b(),j(p,{key:0,label:"收件人:",prop:"email",class:"w-full"},{default:i(()=>[r(w,{style:{width:"50%"},modelValue:t(e).email,"onUpdate:modelValue":n[0]||(n[0]=x=>t(e).email=x),placeholder:"请输入",clearable:""},null,8,["modelValue"])]),_:1})),r(p,{label:"主题:",prop:"subject",class:"w-full"},{default:i(()=>[r(w,{style:{width:"50%"},modelValue:t(e).subject,"onUpdate:modelValue":n[1]||(n[1]=x=>t(e).subject=x),placeholder:"请输入",clearable:"",type:"textarea"},null,8,["modelValue"])]),_:1}),r(p,{label:"正文:",prop:"content",class:"w-full"},{default:i(()=>[(b(),j(v,{key:t(s),"txt-html":t(_),"onUpdate:htmlData":o},null,8,["txt-html"]))]),_:1}),f("div",ae,[r(B,{class:"w-[20%]",type:"success",loading:t(d),onClick:n[2]||(n[2]=x=>("throttle"in l?l.throttle:t(X))(()=>{g(t(y))}))},{default:i(()=>[A(" 发送 ")]),_:1},8,["loading"])])]),_:1},8,["model","rules"])])}}});export{fe as default};
