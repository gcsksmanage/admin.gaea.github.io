import{r as D,az as x,aA as R,aB as b,O as $,T as B,u as g,aC as M,aD as A,aE as U,V as z,e as F,al as H,h as T,a2 as k}from"./entry.aea1d2a1.js";const j=()=>null;function L(...s){const c=typeof s[s.length-1]=="string"?s.pop():void 0;typeof s[0]!="string"&&s.unshift(c);let[t,n,r={}]=s;if(typeof t!="string")throw new TypeError("[nuxt] [asyncData] key must be a string.");if(typeof n!="function")throw new TypeError("[nuxt] [asyncData] handler must be a function.");r.server=r.server??!0,r.default=r.default??j,r.lazy=r.lazy??!1,r.immediate=r.immediate??!0;const e=B(),l=()=>e.isHydrating?e.payload.data[t]:e.static.data[t],o=()=>l()!==void 0;e._asyncData[t]||(e._asyncData[t]={data:D(l()??r.default()),pending:D(!o()),error:x(e.payload._errors,t),status:D("idle")});const a={...e._asyncData[t]};a.refresh=a.execute=(u={})=>{if(e._asyncDataPromises[t]){if(u.dedupe===!1)return e._asyncDataPromises[t];e._asyncDataPromises[t].cancelled=!0}if((u._initial||e.isHydrating&&u._initial!==!1)&&o())return l();a.pending.value=!0,a.status.value="pending";const d=new Promise((i,f)=>{try{i(n(e))}catch(v){f(v)}}).then(i=>{if(d.cancelled)return e._asyncDataPromises[t];let f=i;r.transform&&(f=r.transform(i)),r.pick&&(f=S(f,r.pick)),a.data.value=f,a.error.value=null,a.status.value="success"}).catch(i=>{if(d.cancelled)return e._asyncDataPromises[t];a.error.value=i,a.data.value=g(r.default()),a.status.value="error"}).finally(()=>{d.cancelled||(a.pending.value=!1,e.payload.data[t]=a.data.value,a.error.value&&(e.payload._errors[t]=M(a.error.value)),delete e._asyncDataPromises[t])});return e._asyncDataPromises[t]=d,e._asyncDataPromises[t]};const h=()=>a.refresh({_initial:!0}),_=r.server!==!1&&e.payload.serverRendered;{const u=A();if(u&&!u._nuxtOnBeforeMountCbs){u._nuxtOnBeforeMountCbs=[];const i=u._nuxtOnBeforeMountCbs;u&&(R(()=>{i.forEach(f=>{f()}),i.splice(0,i.length)}),b(()=>i.splice(0,i.length)))}_&&e.isHydrating&&o()?(a.pending.value=!1,a.status.value=a.error.value?"error":"success"):u&&(e.payload.serverRendered&&e.isHydrating||r.lazy)&&r.immediate?u._nuxtOnBeforeMountCbs.push(h):r.immediate&&h(),r.watch&&$(r.watch,()=>a.refresh());const d=e.hook("app:data:refresh",i=>{if(!i||i.includes(t))return a.refresh()});u&&b(d)}const m=Promise.resolve(e._asyncDataPromises[t]).then(()=>a);return Object.assign(m,a),m}function S(s,c){const t={};for(const n of c)t[n]=s[n];return t}function G(s,c,t){const[n={},r]=typeof c=="string"?[{},c]:[c,t],e=n.key||U([r,g(n.baseURL),typeof s=="string"?s:"",g(n.params||n.query)]);if(!e||typeof e!="string")throw new TypeError("[nuxt] [useFetch] key must be a string: "+e);if(!s)throw new Error("[nuxt] [useFetch] request is missing.");const l=e===r?"$f"+e:e,o=z(()=>{let p=s;return typeof p=="function"&&(p=p()),g(p)});if(!n.baseURL&&typeof o.value=="string"&&o.value.startsWith("//"))throw new Error('[nuxt] [useFetch] the request URL must not start with "//".');const{server:a,lazy:h,default:_,transform:m,pick:u,watch:d,immediate:i,...f}=n,v=F({...f,cache:typeof n.cache=="boolean"?void 0:n.cache}),O={server:a,lazy:h,default:_,transform:m,pick:u,immediate:i,watch:d===!1?[]:[v,o,...d||[]]};let y;return L(l,()=>{var w;return(w=y==null?void 0:y.abort)==null||w.call(y),y=typeof AbortController<"u"?new AbortController:{},typeof o.value=="string"&&o.value.startsWith("/"),(n.$fetch||globalThis.$fetch)(o.value,{signal:y.signal,...v})},O)}const q="https://api.gaea.la";let E=!1,I=0;const K=2e4,W=s=>({"Content-Type":"application/json",Authorization:`Bearer ${s}`}),P=s=>{var r,e,l,o,a,h;const c=Date.now(),t=((r=s.data)==null?void 0:r.message)||((e=s.data)==null?void 0:e.msg)||((a=(o=(l=s.data)==null?void 0:l.detail)==null?void 0:o[0])==null?void 0:a.msg)||s.detail||((h=s.data)==null?void 0:h.detail)||"network error",n=s.statusCode;if(!((t==="network error"||n===502)&&c-I<K)&&n!==502){if(n===403){k("/login");return}if(n!==503){T.error(t);return}}},C=async(s,c,t)=>{const n=H(),r=W(n.getToken),e=`${q}${s}`;try{const{data:l,error:o}=await G(e,{...c,headers:r,responseType:t},"$mr5k66ooDp");if(l.value)return l.value;const{statusCode:a}=o.value;if(o.value)return a===401||a===403&&!E?(T.error(o.value.data.detail),E=!0,k("/login"),!1):P(o.value)}catch(l){return P(l)}},J=(s,c,t="json")=>C(s,{method:"GET",params:c},t),Q=(s,c,t="json")=>C(s,{method:"POST",body:c},t);export{J as G,Q as P};
