import{d as U,r as w,e as v,P as $,o as h,c as k,f as n,w as d,u as l,I as B,J as R,b as I,g as y,h as f,i as F,j as A,R as S,k as N,l as T,m as C,y as j,p as q,a as P,Q as z,_ as G}from"./entry.ca22f7bd.js";/* empty css                 *//* empty css                *//* empty css                       *//* empty css                        *//* empty css                  */import{v as J,x as L,y as M,z as Q,A as H}from"./adminManage.a59ee123.js";import{t as K}from"./throttle.46d02480.js";import"./request.0c7932b7.js";const O=m=>(q("data-v-0bf5354a"),m=m(),P(),m),W={class:"w-fit text-[#EBEBEB] pl-10 mt-10"},X=O(()=>I("p",{class:"text-red-500 text-[12px] ml-24 mb-2"},"注：多个UID用逗号隔开",-1)),Y={class:"w-full flex justify-end"},Z=U({__name:"reward-distribution",setup(m){const _=w(),b=[{value:"points",key:"points",label:"积分",api:J,min:1,max:1e4},{value:"soul",key:"soul",label:"心灵点",api:L,min:1,max:500},{value:"number",key:"blindbox",label:"盲盒",api:M,min:1,max:200},{value:"number",key:"ticketbox",label:"票盒",api:Q,min:1,max:200},{value:"sxp",key:"sxp",label:"sxp",api:H,min:1,max:1e4}],E=v({uids:[{required:!0,message:"请输入用户ID",trigger:"blur"},{validator:(o,e,a)=>{if(!e.trim()){a(new Error("请输入用户ID"));return}const t=e.split(",").map(i=>i.trim());for(const i of t){if(!/^\d+$/.test(i)){a(new Error("UID 格式错误，必须为数字"));return}if(i.length!==14){a(new Error("UID 长度必须为14位"));return}}a()},trigger:"blur"}],num:[{required:!0,message:"请输入",trigger:"blur"},{validator:(o,e,a)=>{const t=b.find(i=>i.key===r.type);t&&(e<t.min||e>t.max)?a(new Error(`${t.label}数应在 ${t.min} 到 ${t.max} 之间`)):a()},trigger:"blur"}],type:[{required:!0,message:"请选择奖励类型",trigger:"change"}]}),c=w(!1),r=v({uids:"",type:"points",num:1,points:null,soul:null,blindbox:null,ticketbox:null,description:""});$(()=>r.type,o=>{o!==void 0&&(r.num=1)});const x=o=>{o&&o.resetFields()},V=async o=>{o&&(c.value||await o.validate(async(e,a)=>{if(!e)return;const t=b.find(u=>u.key===r.type);if(!t){f.error("未找到对应的奖励类型");return}const i=r.uids.split(",").map(u=>`${u.trim()}`).join(",");try{const u={uids:i,[t.value]:Number(r.num)};c.value=!0;const p=await t.api(u);p.code===200?f.success(`${t.label}奖励发放成功,${p.data}`):f.error(p.msg||"奖励发放失败")}catch{f.error("奖励发放失败，请稍后再试")}finally{c.value=!1,x(o)}}))};return(o,e)=>{const a=F,t=A,i=z,u=S,p=N,g=T,D=C;return h(),k("div",W,[n(D,{ref_key:"ruleFormRef",ref:_,inline:!0,"label-position":"right","label-width":"90px",model:l(r),rules:l(E),class:"flex flex-col w-fit"},{default:d(()=>[X,n(t,{label:"用户ID:",prop:"uids",class:"w-[470px]"},{default:d(()=>[n(a,{autosize:"",type:"textarea",style:{width:"100%"},"controls-position":"right",modelValue:l(r).uids,"onUpdate:modelValue":e[0]||(e[0]=s=>l(r).uids=s),placeholder:"请输入",clearable:""},null,8,["modelValue"])]),_:1}),n(t,{label:"奖励:",prop:"type"},{default:d(()=>[n(u,{modelValue:l(r).type,"onUpdate:modelValue":e[1]||(e[1]=s=>l(r).type=s)},{default:d(()=>[(h(),k(B,null,R(b,(s,te)=>n(i,{label:s.key,key:s.key},{default:d(()=>[y(j(s.label),1)]),_:2},1032,["label"])),64))]),_:1},8,["modelValue"])]),_:1}),n(t,{label:"数量:",prop:"num",class:"w-[350px]"},{default:d(()=>[n(p,{min:1,max:1e4,"controls-position":"right",modelValue:l(r).num,"onUpdate:modelValue":e[2]||(e[2]=s=>l(r).num=s),placeholder:"请输入",clearable:"",style:{width:"180px"}},null,8,["modelValue"])]),_:1}),I("div",Y,[n(g,{class:"w-[20%]",type:"danger",onClick:e[3]||(e[3]=s=>x(l(_)))},{default:d(()=>[y(" 重置 ")]),_:1}),n(g,{class:"w-[20%]",type:"success",loading:l(c),onClick:e[4]||(e[4]=s=>("throttle"in o?o.throttle:l(K))(()=>{V(l(_))}))},{default:d(()=>[y(" 发放 ")]),_:1},8,["loading"])])]),_:1},8,["model","rules"])])}}});const pe=G(Z,[["__scopeId","data-v-0bf5354a"]]);export{pe as default};
