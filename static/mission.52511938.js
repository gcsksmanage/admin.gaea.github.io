import{d as h,r as w,e as k,o as T,c as z,f as t,w as a,b as C,t as D,u as o,v as B,g as m,q as j,E as V,O as P,P as q,i as I,h as G,j as S,k as L,l as W,m as X,_ as O,n as H,s as J,C as K,x as Q,y as Y,z as Z,A as ee,B as le}from"./entry.15a76552.js";import{_ as te}from"./client-only.17f8f7d7.js";/* empty css                       *//* empty css                *//* empty css                 *//* empty css                        *//* empty css                  *//* empty css                   */import{v as oe,x as ae,y as se,z as re}from"./adminManage.c8246d07.js";import{t as ne}from"./throttle.46d02480.js";/* empty css                 *//* empty css               *//* empty css                */import"./el-tooltip.4ed993c7.js";/* empty css                     *//* empty css                      *//* empty css                  *//* empty css                   */import"./request.72540ff6.js";const ie={class:"text-[#ebebeb] text-[16px]"},de={class:"w-full flex justify-end"},ue=h({__name:"Add",props:{dialogVisible:{type:Boolean,default:!1},item:{default:{}}},emits:["update:closeDialog","update:success"],setup(R,{emit:c}){const r=R,g=w(!1),e=k({id:null,code:"RETWEET_X",title:"",description:"",url:"",points:null,soul:null,order:1,mark:1,status:1,rewardType:1,rewardNum:1}),f=w(),_=k({title:[{required:!0,message:"请输入",trigger:"blur"}],description:[{required:!0,message:"请输入",trigger:"blur"}],url:[{required:!0,message:"请输入",trigger:"blur"},{validator:(s,l,u)=>{if(/%(?:2[1-9a-fA-F]|[3-6][0-9a-fA-F]|7[0-9a-eA-E])|[<>'"\\\x00-\x1F\x7F]/.test(l))return u(new Error("URL不能包含任何转义字符"));if(!/^(https?|ftp):\/\/[^\s/$.?#].[^\s]*$/i.test(l))return u(new Error("请输入有效的URL"));u()},trigger:"blur"}],rewardNum:[{required:!0,message:"请输入",trigger:"blur"}]}),b=s=>{s&&s.resetFields()},N=async s=>{s&&(g.value||await s.validate(async(l,u)=>{if(l)try{g.value=!0;const d={...e,id:r.item.id,points:e.rewardType===1?e.rewardNum:0,soul:e.rewardType===2?e.rewardNum:0};var n=null;r.item.id?(delete d.code,n=await oe(d)):(delete d.id,n=await ae(d)),n.code===200?(V.success({message:"创建成功",grouping:!0,type:"success"}),c("update:success"),y()):V.error({message:n.msg,grouping:!0,type:"error"})}catch{}finally{g.value=!1,b(s)}}))},y=()=>{c("update:closeDialog"),b(f.value)},U=async()=>{r.item.id?(e.id=r.item.id,e.title=r.item.title,e.description=r.item.description,e.url=r.item.url,e.order=r.item.order,e.mark=r.item.mark,e.status=r.item.status,e.rewardNum=r.item.points>0?r.item.points:r.item.soul,e.rewardType=r.item.points>0?1:2):(e.id=null,e.code="RETWEET_X",e.title="",e.description="",e.url="",e.order=1,e.mark=1,e.status=1,e.rewardType=1,e.rewardNum=0)};return(s,l)=>{const u=P,n=q,d=I,v=G,x=S,E=L,A=W,p=X,F=te;return T(),z("div",null,[t(F,null,{default:a(()=>[t(p,{draggable:"","model-value":s.$props.dialogVisible,style:{"background-color":"black",border:"1px  #ebebeb solid","border-radius":"10px","padding-bottom":"30px"},title:"",width:"550px",class:"px-10","align-center":"",onClose:y,onOpen:l[11]||(l[11]=$=>U())},{default:a(()=>{var $;return[C("p",ie,D(($=o(e))!=null&&$.id?"编辑任务":"创建任务"),1),t(A,{ref_key:"ruleFormRef",ref:f,class:"w-full p-5",inline:!0,"label-position":"right","label-width":"140px",model:o(e),rules:o(_)},{default:a(()=>{var M;return[(M=o(e))!=null&&M.id?j("",!0):(T(),B(d,{key:0,label:"选择类型:",prop:"code",class:"w-full"},{default:a(()=>[t(n,{modelValue:o(e).code,"onUpdate:modelValue":l[0]||(l[0]=i=>o(e).code=i)},{default:a(()=>[t(u,{label:"RETWEET_X"},{default:a(()=>[m("转推")]),_:1}),t(u,{label:"EVENT_PARTNER"},{default:a(()=>[m("合作")]),_:1})]),_:1},8,["modelValue"])]),_:1})),t(d,{label:"标题:",prop:"title",class:"w-full"},{default:a(()=>[t(v,{style:{width:"100%"},"controls-position":"right",modelValue:o(e).title,"onUpdate:modelValue":l[1]||(l[1]=i=>o(e).title=i),placeholder:"请输入",clearable:""},null,8,["modelValue"])]),_:1}),t(d,{label:"详情:",prop:"description",class:"w-full"},{default:a(()=>[t(v,{type:"textarea",style:{width:"100%"},"controls-position":"right",modelValue:o(e).description,"onUpdate:modelValue":l[2]||(l[2]=i=>o(e).description=i),placeholder:"请输入",clearable:""},null,8,["modelValue"])]),_:1}),t(d,{label:"任务链接:",class:"w-full"},{default:a(()=>[t(v,{style:{width:"100%"},"controls-position":"right",modelValue:o(e).url,"onUpdate:modelValue":l[3]||(l[3]=i=>o(e).url=i),placeholder:"请输入",clearable:""},null,8,["modelValue"])]),_:1}),t(d,{label:"排序:",prop:"order",class:"w-full"},{default:a(()=>[t(x,{style:{width:"100%"},min:1,max:1e3,"controls-position":"right",modelValue:o(e).order,"onUpdate:modelValue":l[4]||(l[4]=i=>o(e).order=i),placeholder:"请输入",clearable:""},null,8,["modelValue"])]),_:1}),t(d,{label:"奖励类型:",prop:"rewardType",class:"w-full"},{default:a(()=>[t(n,{modelValue:o(e).rewardType,"onUpdate:modelValue":l[5]||(l[5]=i=>o(e).rewardType=i)},{default:a(()=>[t(u,{label:1},{default:a(()=>[m("积分")]),_:1}),t(u,{label:2},{default:a(()=>[m("心灵点")]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(d,{label:"数量:",prop:"rewardNum",class:"w-full"},{default:a(()=>[t(x,{style:{width:"100%"},min:1,max:o(e).rewardType===1?2e3:200,"controls-position":"right",modelValue:o(e).rewardNum,"onUpdate:modelValue":l[6]||(l[6]=i=>o(e).rewardNum=i),placeholder:"请输入",clearable:""},null,8,["max","modelValue"])]),_:1}),t(d,{label:"是否显示最新:",prop:"mark",class:"w-full"},{default:a(()=>[t(n,{modelValue:o(e).mark,"onUpdate:modelValue":l[7]||(l[7]=i=>o(e).mark=i)},{default:a(()=>[t(u,{label:1},{default:a(()=>[m("是")]),_:1}),t(u,{label:0},{default:a(()=>[m("否")]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(d,{label:"是否删除:",prop:"status",class:"w-full"},{default:a(()=>[t(n,{modelValue:o(e).status,"onUpdate:modelValue":l[8]||(l[8]=i=>o(e).status=i)},{default:a(()=>[t(u,{label:0},{default:a(()=>[m("是")]),_:1}),t(u,{label:1},{default:a(()=>[m("否")]),_:1})]),_:1},8,["modelValue"])]),_:1}),C("div",de,[t(E,{class:"w-[20%]",type:"info",onClick:l[9]||(l[9]=i=>y())},{default:a(()=>[m(" 取消 ")]),_:1}),t(E,{class:"w-[20%]",type:"success",loading:o(g),onClick:l[10]||(l[10]=i=>("throttle"in s?s.throttle:o(ne))(()=>{N(o(f))}))},{default:a(()=>[m(" 保存 ")]),_:1},8,["loading"])])]}),_:1},8,["model","rules"])]}),_:1},8,["model-value"])]),_:1})])}}});const pe=O(ue,[["__scopeId","data-v-eaba32f3"]]),me={class:"w-full h-[85vh] flex flex-col justify-between space-y-5 p-5"},ce={class:"flex items-center justify-end"},fe={class:"flex justify-end"},he=h({__name:"mission",setup(R){const c=w(!1),r=w(!1),g=w(!1),e=w(),f=k({content:[]}),_=k({page:1,limit:20}),b=async()=>{try{r.value=!0;const s=await se();r.value=!1,s.code===200?(f.content=s.data,f.totalElements=s.total):(f.content=[],f.totalElements=0,V({message:s.msg,grouping:!0,type:"error"}))}catch{r.value=!1}},N=s=>{_.page=s,b()},y=s=>{_.limit=s,b()},U=async()=>{try{g.value=!0;const s=await re();g.value=!1,s.code===200?V({message:s.msg,grouping:!0,type:"success"}):V({message:s.msg,grouping:!0,type:"error"})}catch{}finally{g.value=!1}};return H(()=>{b()}),(s,l)=>{const u=L,n=Q,d=Y,v=Z,x=ee,E=pe,A=le;return T(),z("div",me,[C("div",ce,[t(u,{class:"w-[100px]",type:"success",onClick:l[0]||(l[0]=p=>(c.value=!0,e.value={}))},{default:a(()=>[m(" 创建任务 ")]),_:1}),t(u,{class:"w-[100px]",type:"primary",onClick:l[1]||(l[1]=p=>U()),loading:o(g)},{default:a(()=>[m(" 发布任务 ")]),_:1},8,["loading"])]),J((T(),B(v,{ref:"multipleTableRef",class:"w-full flex-1",data:o(f).content,border:""},{default:a(()=>[t(n,{label:"标题",prop:"title",align:"center","show-overflow-tooltip":""}),t(n,{label:"详情",prop:"description",align:"center","show-overflow-tooltip":""}),t(n,{label:"任务链接",prop:"url",align:"center","show-overflow-tooltip":""}),t(n,{label:"编码",prop:"code",align:"center","show-overflow-tooltip":""}),t(n,{label:"奖励积分",prop:"points",align:"center"}),t(n,{label:"奖励心灵点",prop:"soul",align:"center"}),t(n,{label:"排序",prop:"order",align:"center"}),t(n,{label:"是否显示最新",prop:"mark",align:"center"},{default:a(p=>[m(D(p.row.mark?"是":"否"),1)]),_:1}),t(n,{label:"操作",align:"center"},{default:a(p=>[t(d,{type:"success",onClick:F=>(e.value=p.row,c.value=!0)},{default:a(()=>[m("编辑")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[A,o(r)]]),C("div",fe,[t(x,{"current-page":o(_).page,"onUpdate:currentPage":l[2]||(l[2]=p=>o(_).page=p),"page-size":o(_).limit,"onUpdate:pageSize":l[3]||(l[3]=p=>o(_).limit=p),"page-sizes":[20,50,100,500,1e3],layout:"total, sizes, prev, pager, next, jumper",total:o(f).totalElements,onCurrentChange:N,onSizeChange:y},null,8,["current-page","page-size","total"])]),t(E,{modelValue:o(c),"onUpdate:modelValue":l[4]||(l[4]=p=>K(c)?c.value=p:null),"dialog-visible":o(c),"onUpdate:closeDialog":l[5]||(l[5]=p=>c.value=!1),item:o(e),"onUpdate:success":l[6]||(l[6]=p=>b())},null,8,["modelValue","dialog-visible","item"])])}}});export{he as default};
